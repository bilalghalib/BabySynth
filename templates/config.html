<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öôÔ∏è BabySynth - Config Editor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/editor.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>‚öôÔ∏è BabySynth Config Editor</h1>
            <p class="subtitle">Visually edit YAML configurations</p>
            <nav>
                <a href="/" class="nav-link">üì∫ Live View</a>
                <a href="/editor" class="nav-link">üéõÔ∏è Audio Engine</a>
                <a href="/config" class="nav-link active">‚öôÔ∏è Config Editor</a>
            </nav>
        </header>

        <main class="editor-main">
            <!-- Config Selector -->
            <section class="panel">
                <h2>üìÅ Select Configuration</h2>
                <div class="config-selector">
                    <select id="config-select">
                        <option value="config.yaml">config.yaml (Main)</option>
                        <option value="configs/baby_config.yaml">baby_config.yaml</option>
                        <option value="configs/drum_kit.yaml">drum_kit.yaml</option>
                        <option value="configs/baby_grunge.yaml">baby_grunge.yaml</option>
                        <option value="configs/baby_toxic.yaml">baby_toxic.yaml</option>
                    </select>
                    <button id="load-config" class="btn-primary">üìÇ Load</button>
                    <button id="new-config" class="btn-secondary">‚ûï New Config</button>
                </div>
            </section>

            <!-- Visual Grid Layout Editor -->
            <section class="panel">
                <h2>üéπ Grid Layout Designer</h2>
                <div class="layout-tools">
                    <label>Model Name: <input type="text" id="model-name" value="ADGC" placeholder="e.g., ADGC"></label>
                    <label>Paint Tool:
                        <select id="paint-note">
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                            <option value="E">E</option>
                            <option value="F">F</option>
                            <option value="G">G</option>
                            <option value="x">x (empty)</option>
                            <option value=".">. (inactive)</option>
                        </select>
                    </label>
                    <button id="clear-layout">üßπ Clear All</button>
                </div>
                <div class="layout-grid" id="config-layout-grid">
                    <!-- 9x9 grid generated by JS -->
                </div>
                <div class="layout-preview">
                    <h3>YAML Preview:</h3>
                    <pre id="layout-yaml-preview">layout: |
  xxxxxxxxx
  ABCDEFGAx
  BCDEFGABx</pre>
                </div>
            </section>

            <!-- Color Editor -->
            <section class="panel">
                <h2>üé® Color Palette</h2>
                <div class="color-editor" id="color-editor">
                    <div class="color-row">
                        <label>C:</label>
                        <input type="color" value="#ff0000" data-note="C">
                        <input type="text" value="255, 0, 0" readonly>
                    </div>
                    <div class="color-row">
                        <label>D:</label>
                        <input type="color" value="#00ff00" data-note="D">
                        <input type="text" value="0, 255, 0" readonly>
                    </div>
                    <div class="color-row">
                        <label>E:</label>
                        <input type="color" value="#0000ff" data-note="E">
                        <input type="text" value="0, 0, 255" readonly>
                    </div>
                    <div class="color-row">
                        <label>F:</label>
                        <input type="color" value="#ffff00" data-note="F">
                        <input type="text" value="255, 255, 0" readonly>
                    </div>
                    <div class="color-row">
                        <label>G:</label>
                        <input type="color" value="#00ffff" data-note="G">
                        <input type="text" value="0, 255, 255" readonly>
                    </div>
                    <div class="color-row">
                        <label>A:</label>
                        <input type="color" value="#ff00ff" data-note="A">
                        <input type="text" value="255, 0, 255" readonly>
                    </div>
                    <div class="color-row">
                        <label>B:</label>
                        <input type="color" value="#808080" data-note="B">
                        <input type="text" value="128, 128, 128" readonly>
                    </div>
                </div>
            </section>

            <!-- Advanced Features -->
            <section class="panel">
                <h2>‚ú® Advanced Features</h2>

                <div class="feature-section">
                    <h3>üé≠ LED Animations</h3>
                    <p>Define looping LED animations (NEW!)</p>
                    <textarea id="animations-editor" rows="6" placeholder="animations:
  rainbow_wave:
    duration: 2.0
    loop: true
    frames:
      - {delay: 0.1, pattern: [[255,0,0], [255,127,0], ...]}"></textarea>
                </div>

                <div class="feature-section">
                    <h3>üéµ Chord Progressions</h3>
                    <p>Define chord sequences for buttons (NEW!)</p>
                    <textarea id="chords-editor" rows="4" placeholder="chord_progressions:
  happy_progression: [C, F, G, C]
  sad_progression: [A, D, E, A]"></textarea>
                </div>

                <div class="feature-section">
                    <h3>üåà Themes</h3>
                    <p>Color palettes you can switch between (NEW!)</p>
                    <textarea id="themes-editor" rows="4" placeholder="themes:
  ocean: {C: [0,100,200], D: [0,150,255], ...}
  sunset: {C: [255,100,0], D: [255,150,50], ...}"></textarea>
                </div>

                <div class="feature-section">
                    <h3>‚ö° Macros</h3>
                    <p>Button combinations that trigger sequences (NEW!)</p>
                    <textarea id="macros-editor" rows="4" placeholder="macros:
  combo_1:
    trigger: [[0,0], [0,1]]  # Press these together
    action: play_animation('rainbow_wave')"></textarea>
                </div>
            </section>

            <!-- Raw YAML Editor -->
            <section class="panel">
                <h2>üìù Raw YAML Editor</h2>
                <textarea id="raw-yaml-editor" rows="20" spellcheck="false" style="font-family: monospace; width: 100%; padding: 15px; border-radius: 8px; border: 2px solid #ddd;">name: ADGC
models:
  ADGC:
    layout: |
      xxxxxxxxx
      ABCDEFGAx
      BCDEFGABx
scales:
  C_major: [C, D, E, F, G, A, B]
colors:
  C: [255, 0, 0]
  D: [0, 255, 0]
...</textarea>
                <button id="validate-yaml" class="btn-secondary">‚úÖ Validate YAML</button>
                <div id="yaml-validation-result"></div>
            </section>
        </main>

        <footer>
            <button id="save-config" class="apply-btn">üíæ Save Configuration</button>
            <button id="apply-config" class="apply-btn">üöÄ Apply & Hot Reload</button>
            <p>BabySynth Config Editor v1.0</p>
        </footer>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <script src="{{ url_for('static', filename='js/config_editor.js') }}"></script>
</body>
</html>
